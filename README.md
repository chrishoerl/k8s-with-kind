# k8s-with-kind

## How to create local clusters with kind directly from k8s sources

### Motivation

coming soon

### Prerequisites

- docker version 23.0.1
- go version go1.19.3
- Ubuntu 22.04 (Jammy)


#### determine your $GOPATH

```shell
go env $GOPATH

# Result:
# /home/<user>/go
```

#### Download Kubernetes sources

```shell
mkdir -p $GOPATH/src/k8s.io
cd $GOPATH/src/k8s.io
git clone https://github.com/kubernetes/kubernetes
cd kubernetes
```

#### Checkout a specific version

````shell
git checkout v1.25.3
```

#### Change the default validity of certificates issued by kubeadm

* Therefore edit this file:

```shell
vi GOPATH/src/k8s.io/kubernetes/cmd/kubeadm/app/constants
```

* Change this line:

```go
// CertificateValidity defines the validity for all the signed certificates generated by kubeadm
// CertificateValidity = time.Hour * 24 * 365
// change validity to 10 minutes
CertificateValidity = time.Hour / 6
```

* See the original source code

https://github.com/kubernetes/kubernetes/blob/v1.25.3/cmd/kubeadm/app/constants/constants.go#L49

#### Create a node-image for kind

```shell
# build with 1 single kind command
kind build node-image --image=myname/node:v1.25.3-shorttime
```
